# Fukuoka Flight Tracker

---
## ⚠️ 规范执行保障机制（最高优先级）

**问题**：Claude 在复杂任务中容易遗漏全局 CLAUDE.md 的规范要求。

**解决方案**：三阶段强制检查 + 输出确认

### 阶段 A：任务开始时（必做）
```
📋 任务开始检查：
- [ ] 已阅读全局 CLAUDE.md（项目根目录/../CLAUDE.md）
- [ ] 已阅读项目 CLAUDE.md
- [ ] 已阅读 需求记录.md（用户需求和关键参数）
- [ ] 已识别本次任务涉及的规范条目
- [ ] 输出：本次任务需遵守的规范摘要
```

### 阶段 B：代码完成时（必做）
```
📋 代码完成检查：
- [ ] 功能实现完整
- [ ] 无控制台错误
- [ ] 响应式设计已验证
- [ ] 输出：代码完成状态确认
```

### 阶段 C：任务结束前（必做，防止遗漏部署）
```
📋 任务结束检查：
- [ ] 敏感信息检查（3个Agent）已完成
- [ ] .gitignore 已更新
- [ ] GitHub 已上传
- [ ] Vercel 已部署（前端）
- [ ] Render 已部署（后端，如有）
- [ ] 最终 URL 已告知用户
- [ ] 输出：完整检查报告
```

### 执行规则
1. **每个阶段必须输出对应的检查清单**
2. **未完成的项目用 ❌ 标记并说明原因**
3. **用户可随时说"检查规范"触发完整检查**
4. **Claude 在被打断后恢复工作时，必须重新执行阶段 A**

---

## ⚠️ 截图自检规范（防止"看了等于没看"）

> **核心原则：截图不是终点，必须分析截图内容是否符合预期。**

**问题根因**：Claude 截图后可能只确认"页面能打开"，却忽略数据异常（如0架飞机、空列表）。

**强制检查项**：截图后必须逐条验证：

| 检查项 | 正常标准 | 异常处理 |
|--------|----------|----------|
| 飞机数量 | > 0 | 检查后端是否运行、API是否正常 |
| 到达航班列表 | > 0 条 | 检查时刻表API调用 |
| 出发航班列表 | > 0 条 | 检查时刻表API调用 |
| 地图飞机图标 | 可见 | 检查位置数据是否返回 |
| 控制台 | 无红色错误 | 修复后重新验证 |

**自检流程**：
```
1. 截图
2. 逐项检查上表（数据为0/空 = 异常）
3. 异常 → 排查原因 → 修复 → 重新截图
4. 全部正常 → 自检通过
```

**禁止行为**：
- ❌ 看到"0架飞机"却不追问原因
- ❌ 截图后直接说"正常"而不检查数据
- ❌ 只检查页面能否打开，不检查数据内容

---

## ⚠️ 本地启动检查清单

启动本地环境时，必须确认：
- [ ] 前端服务器运行中（端口5173）
- [ ] **后端服务器运行中（端口3001）** ← 常遗漏
- [ ] API健康检查通过：`curl http://localhost:3001/health`

**快捷命令**：`npm run dev:all`（同时启动前后端）

---

## ⚠️ 需求记录（修改前必读）

**文件位置**：`需求记录.md`

**包含内容**：
- 用户需求时间线（所有已确认的功能需求）
- 关键参数（不可擅自修改的配置值）
- 作业历史（每次修改的自检记录）
- 禁止修改项列表

**修改代码前必须**：
1. 阅读 `需求记录.md`
2. 确认修改不会违反用户需求
3. 在作业历史中记录本次修改的自检过程

---

## 项目概述
实时追踪福冈机场（RJFF）100km范围内的航班，交互式地图 + 航班列表。

## 技术栈
- **前端**: React 19 + TypeScript + Vite
- **样式**: styled-components
- **地图**: Leaflet + react-leaflet
- **状态管理**: React Context
- **后端**: Express (代理服务器)
- **API**: OpenSky Network (OAuth2)

## 目录结构
```
src/
├── components/       # React组件
│   ├── DashboardLayout.tsx   # 主布局（响应式）
│   ├── MapContainer.tsx      # Leaflet地图
│   ├── FlightListsContainer.tsx
│   └── FlightList.tsx
├── context/          # 全局状态
│   └── FlightContext.tsx
├── hooks/            # 自定义Hook
│   ├── useOpenSkyApi.ts
│   └── useWindowSize.ts
├── services/         # API服务
│   └── opensky.ts
└── types/            # 类型定义
    └── flight.ts

server/               # Express代理服务器
└── index.js
```

## 常用命令
```bash
npm run dev           # 前端开发服务器 (5173)
npm run dev:server    # 后端代理服务器 (3001)
npm run dev:all       # 同时启动前后端
npm run build         # 生产构建
npm run lint          # ESLint检查
```

## 环境变量
```env
# 前端 (.env)
VITE_OPENSKY_CLIENT_ID=xxx
VITE_OPENSKY_CLIENT_SECRET=xxx

# 后端 (server/.env)
OPENSKY_CLIENT_ID=xxx
OPENSKY_CLIENT_SECRET=xxx
PORT=3001
```

## 核心功能
- 飞机位置: 每45秒刷新
- 航班列表: 每5分钟刷新
- 福冈机场坐标: 33.5859, 130.451
- 覆盖范围: 100km

## 注意事项
- OpenSky API 有速率限制，已实现指数退避重试
- 响应式设计：桌面左右分栏，移动端标签切换
